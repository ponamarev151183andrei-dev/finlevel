<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>FinLevel ‚Äî –ü–æ–ª–Ω–∞—è –≤–µ—Ä—Å–∏—è</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        body {
            font-family: Arial, sans-serif;
            padding: 10px;
            background: #1a1a2e;
            color: white;
        }
        h1 {
            color: #6c5ce7;
            font-size: 24px;
            margin-bottom: 10px;
            text-align: center;
        }
        h2 {
            font-size: 16px;
            margin-bottom: 8px;
            color: #a0a0a0;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .card {
            background: #16213e;
            border-radius: 16px;
            padding: 15px;
            margin-bottom: 12px;
            border-left: 4px solid #6c5ce7;
        }
        .balance-large {
            font-size: 32px;
            font-weight: bold;
            color: #f1c40f;
        }
        .row {
            display: flex;
            gap: 8px;
            margin: 10px 0;
            flex-wrap: wrap;
        }
        .category-row {
            display: flex;
            gap: 8px;
            margin: 10px 0;
        }
        .category {
            flex: 1;
            padding: 10px;
            border-radius: 10px;
            text-align: center;
            font-size: 14px;
        }
        .needs { background: #e74c3c; }
        .wants { background: #f39c12; }
        .savings-cat { background: #2ecc71; }
        .asset-row {
            display: flex;
            gap: 8px;
            margin: 10px 0;
        }
        .asset {
            flex: 1;
            padding: 10px;
            border-radius: 10px;
            background: #0f3460;
            text-align: center;
        }
        .progress-bar {
            background: #0f3460;
            height: 12px;
            border-radius: 6px;
            margin: 8px 0;
            overflow: hidden;
        }
        .progress-fill {
            background: #6c5ce7;
            height: 100%;
            width: 0%;
            border-radius: 6px;
            transition: width 0.3s;
        }
        .button {
            background: #6c5ce7;
            color: white;
            border: none;
            border-radius: 10px;
            padding: 12px 16px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: opacity 0.2s;
            margin: 4px;
            flex: 1 1 auto;
            min-width: 120px;
        }
        .button:active {
            opacity: 0.7;
        }
        .button-group {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            justify-content: center;
            margin: 8px 0;
        }
        .pillow-btn { background: #27ae60; }
        .market-btn { background: #e67e22; }
        .risk-btn { background: #9b59b6; }
        .dividend-btn { background: #3498db; }
        .goal-btn { background: #e67e22; }
        .close-btn { background: #7f8c8d; }
        .budget-btn { background: #f39c12; }
        .reset-btn { background: #e74c3c; }
        .shop-btn { background: #9b59b6; }
        .referral-btn { background: #3498db; }
        .achievement { 
            background: #0f3460; 
            padding: 10px; 
            border-radius: 10px; 
            margin: 5px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .achievement.unlocked {
            background: #27ae60;
            opacity: 0.9;
        }
        .badge {
            background: #6c5ce7;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 10px;
            color: white;
            margin-left: 5px;
        }
        .chart {
            background: #0f3460;
            height: 100px;
            border-radius: 8px;
            margin: 10px 0;
            display: flex;
            align-items: flex-end;
            gap: 2px;
            padding: 5px;
        }
        .chart-bar {
            flex: 1;
            background: #6c5ce7;
            border-radius: 4px 4px 0 0;
            transition: height 0.3s;
            min-width: 3px;
        }
    </style>
</head>
<body>
    <h1>üí∞ FinLevel</h1>
    
    <!-- –í–ò–ó–£–ê–õ–ò–ó–ê–¶–ò–Ø: –ì—Ä–∞—Ñ–∏–∫ —Ä–æ—Å—Ç–∞ –∫–∞–ø–∏—Ç–∞–ª–∞ -->
    <div class="card">
        <h2>üìà –ì—Ä–∞—Ñ–∏–∫ —Ä–æ—Å—Ç–∞ –∫–∞–ø–∏—Ç–∞–ª–∞</h2>
        <div class="chart" id="capitalChart"></div>
    </div>
    
    <!-- –£–†–û–í–ï–ù–¨ 1: –û—Å–Ω–æ–≤–Ω–æ–π —Å—á—ë—Ç -->
    <div class="card">
        <h2>üìå –£—Ä–æ–≤–µ–Ω—å 1: –û—Å–Ω–æ–≤–Ω–æ–π —Å—á—ë—Ç</h2>
        <div style="display: flex; justify-content: space-between; align-items: center;">
            <span>üí∞ –ë–∞–ª–∞–Ω—Å</span>
            <span class="balance-large" id="balance">0</span>
        </div>
        <div class="button-group">
            <button class="button" onclick="addCoin()">‚ûï –ó–∞—Ä–∞–±–æ—Ç–∞—Ç—å 1 –º–æ–Ω–µ—Ç—É</button>
        </div>
    </div>

    <!-- –£–†–û–í–ï–ù–¨ 2: –ü–æ–¥—É—à–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ -->
    <div class="card">
        <h2>üõ°Ô∏è –£—Ä–æ–≤–µ–Ω—å 2: –ü–æ–¥—É—à–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏</h2>
        <div class="stats">
            <span>–ù–∞–∫–æ–ø–ª–µ–Ω–æ: <span id="pillow">0</span></span>
            <span>–¶–µ–ª—å: 1000</span>
        </div>
        <div class="progress-bar">
            <div class="progress-fill" id="pillowProgress"></div>
        </div>
        <button class="button pillow-btn" onclick="saveToPillow()">
            üõ°Ô∏è –û—Ç–ª–æ–∂–∏—Ç—å 10% –≤ –ø–æ–¥—É—à–∫—É
        </button>
    </div>

    <!-- –£–†–û–í–ï–ù–¨ 3: –ë—é–¥–∂–µ—Ç 50-30-20 -->
    <div class="card">
        <h2>üìä –£—Ä–æ–≤–µ–Ω—å 3: –ú–µ—Ç–æ–¥ 50-30-20 <span class="badge">–ë—é–¥–∂–µ—Ç</span></h2>
        <div class="stats">
            <span>ü•ñ –ù—É–∂–Ω–æ–µ (50%)</span>
            <span>üéÆ –•–æ—Ç–µ–ª–∫–∏ (30%)</span>
            <span>üí∞ –°–±–µ—Ä–µ–∂–µ–Ω–∏—è (20%)</span>
        </div>
        <div class="category-row">
            <div class="category needs">
                <div>ü•ñ –ù—É–∂–Ω–æ–µ</div>
                <div style="font-size: 18px; font-weight: bold;" id="needs">0</div>
            </div>
            <div class="category wants">
                <div>üéÆ –•–æ—Ç–µ–ª–∫–∏</div>
                <div style="font-size: 18px; font-weight: bold;" id="wants">0</div>
            </div>
            <div class="category savings-cat">
                <div>üí∞ –°–±–µ—Ä–µ–∂–µ–Ω–∏—è</div>
                <div style="font-size: 18px; font-weight: bold;" id="budgetSavings">0</div>
            </div>
        </div>
        <div class="button-group">
            <button class="button budget-btn" onclick="distributeIncome()">üîÑ –†–∞—Å–ø—Ä–µ–¥–µ–ª–∏—Ç—å 100 –º–æ–Ω–µ—Ç (50-30-20)</button>
        </div>
        <div class="button-group">
            <button class="button" style="background: #e74c3c;" onclick="spend('needs', 10)">ü•ñ –ù—É–∂–Ω–æ–µ -10</button>
            <button class="button" style="background: #f39c12;" onclick="spend('wants', 10)">üéÆ –•–æ—Ç–µ–ª–∫–∏ -10</button>
            <button class="button" style="background: #2ecc71;" onclick="spend('budgetSavings', 10)">üí∞ –°–±–µ—Ä–µ–∂–µ–Ω–∏—è -10</button>
        </div>
    </div>

    <!-- –£–†–û–í–ï–ù–¨ 4: –ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏ -->
    <div class="card">
        <h2>üìà –£—Ä–æ–≤–µ–Ω—å 4: –ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–æ–Ω–Ω—ã–π –ø–æ—Ä—Ç—Ñ–µ–ª—å</h2>
        <div class="asset-row">
            <div class="asset">
                <div>üìä –ê–∫—Ü–∏–∏</div>
                <div style="font-size: 18px; font-weight: bold;" id="stocks">0</div>
            </div>
            <div class="asset">
                <div>üè† –ù–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å</div>
                <div style="font-size: 18px; font-weight: bold;" id="realty">0</div>
            </div>
            <div class="asset">
                <div>‚Çø –ö—Ä–∏–ø—Ç–∞</div>
                <div style="font-size: 18px; font-weight: bold;" id="crypto">0</div>
            </div>
        </div>
        <div class="button-group">
            <button class="button" onclick="invest('stocks', 10)">üìä –ê–∫—Ü–∏–∏ +10</button>
            <button class="button" onclick="invest('realty', 10)">üè† –ù–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å +10</button>
            <button class="button" onclick="invest('crypto', 10)">‚Çø –ö—Ä–∏–ø—Ç–∞ +10</button>
        </div>
        <div class="button-group">
            <button class="button market-btn" onclick="updateMarket()">üîÑ –†—ã–Ω–æ—á–Ω—ã–π –¥–µ–Ω—å (–∏–∑–º–µ–Ω–µ–Ω–∏–µ —Ü–µ–Ω)</button>
        </div>
    </div>

    <!-- –£–†–û–í–ï–ù–¨ 5: –ê–Ω–∞–ª–∏–∑ –ø–æ—Ä—Ç—Ñ–µ–ª—è -->
    <div class="card">
        <h2>üìä –£—Ä–æ–≤–µ–Ω—å 5: –î–∏–≤–µ—Ä—Å–∏—Ñ–∏–∫–∞—Ü–∏—è</h2>
        <div id="riskAnalysis" style="margin: 10px 0; padding: 10px; background: #0f3460; border-radius: 8px; font-size: 14px;">
            –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞
        </div>
        <button class="button risk-btn" onclick="analyzeRisk()">üîç –ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ä–∏—Å–∫–∏</button>
    </div>

    <!-- –£–†–û–í–ï–ù–¨ 6: –ü–∞—Å—Å–∏–≤–Ω—ã–π –¥–æ—Ö–æ–¥ -->
    <div class="card">
        <h2>üíµ –£—Ä–æ–≤–µ–Ω—å 6: –ü–∞—Å—Å–∏–≤–Ω—ã–π –¥–æ—Ö–æ–¥</h2>
        <button class="button dividend-btn" onclick="collectDividends()">üíµ –°–æ–±—Ä–∞—Ç—å –¥–∏–≤–∏–¥–µ–Ω–¥—ã (1% –æ—Ç –ø–æ—Ä—Ç—Ñ–µ–ª—è)</button>
    </div>

    <!-- –£–†–û–í–ï–ù–¨ 7: –§–∏–Ω–∞–Ω—Å–æ–≤–∞—è —Å–≤–æ–±–æ–¥–∞ -->
    <div class="card">
        <h2>üéØ –£—Ä–æ–≤–µ–Ω—å 7: –§–∏–Ω–∞–Ω—Å–æ–≤–∞—è —Å–≤–æ–±–æ–¥–∞</h2>
        <div class="stats">
            <span>–¢–µ–∫—É—â–∞—è —Ü–µ–ª—å: <span id="goalDisplay">10 000</span></span>
            <span>–ü—Ä–æ–≥—Ä–µ—Å—Å: <span id="goalProgress">0%</span></span>
        </div>
        <div class="progress-bar">
            <div class="progress-fill" id="goalProgressBar"></div>
        </div>
        <div class="button-group">
            <button class="button goal-btn" onclick="setGoal()">üéØ –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –Ω–æ–≤—É—é —Ü–µ–ª—å</button>
        </div>
    </div>
    
    <!-- –î–û–°–¢–ò–ñ–ï–ù–ò–Ø -->
    <div class="card">
        <h2>üèÜ –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è</h2>
        <div id="achievement1" class="achievement">
            <span>üí∞ 100 –º–æ–Ω–µ—Ç</span>
            <span id="ach1">‚ùå</span>
        </div>
        <div id="achievement2" class="achievement">
            <span>üîÑ –î–∏–≤–µ—Ä—Å–∏—Ñ–∏–∫–∞—Ü–∏—è (–≤—Å–µ –∞–∫—Ç–∏–≤—ã > 0)</span>
            <span id="ach2">‚ùå</span>
        </div>
        <div id="achievement3" class="achievement">
            <span>üíµ 100+ –¥–∏–≤–∏–¥–µ–Ω–¥–æ–≤</span>
            <span id="ach3">‚ùå</span>
        </div>
    </div>

    <!-- –ú–ê–ì–ê–ó–ò–ù –£–õ–£–ß–®–ï–ù–ò–ô -->
    <div class="card">
        <h2>üõí –ú–∞–≥–∞–∑–∏–Ω —É–ª—É—á—à–µ–Ω–∏–π</h2>
        <div class="button-group">
            <button class="button shop-btn" onclick="buyMultiplier()" id="multiplerBtn">
                üìà –ú–Ω–æ–∂–∏—Ç–µ–ª—å –¥–æ—Ö–æ–¥–∞ x2 (—Ü–µ–Ω–∞: 500)
            </button>
            <button class="button shop-btn" onclick="buyAutoClicker()" id="autoclickerBtn">
                ‚ö° –ê–≤—Ç–æ–∫–ª–∏–∫–µ—Ä (—Ü–µ–Ω–∞: 1000)
            </button>
        </div>
        <div style="margin-top: 10px; font-size: 14px;">
            <span id="multiplierStatus">–ú–Ω–æ–∂–∏—Ç–µ–ª—å: x1</span> | 
            <span id="autoclickerStatus">–ê–≤—Ç–æ–∫–ª–∏–∫–µ—Ä: –≤—ã–∫–ª</span>
        </div>
    </div>

    <!-- –†–ï–§–ï–†–ê–õ–¨–ù–ê–Ø –°–ò–°–¢–ï–ú–ê -->
    <div class="card">
        <h2>üë• –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞</h2>
        <div class="stats">
            <span>–ü—Ä–∏–≥–ª–∞—à–µ–Ω–æ –¥—Ä—É–∑–µ–π: <span id="referralCount">0</span></span>
            <span>–ë–æ–Ω—É—Å: <span id="referralBonus">0</span></span>
        </div>
        <div class="button-group">
            <button class="button referral-btn" onclick="generateReferralLink()">
                üîó –°–æ–∑–¥–∞—Ç—å —Å—Å—ã–ª–∫—É –¥–ª—è –¥—Ä—É–≥–∞
            </button>
        </div>
        <div id="referralLink" style="margin-top: 10px; padding: 10px; background: #0f3460; border-radius: 8px; word-break: break-all; display: none;"></div>
    </div>
    
    <!-- –°–ë–†–û–° –ü–†–û–ì–†–ï–°–°–ê -->
    <div class="card">
        <h2>üîÑ –°–±—Ä–æ—Å –ø—Ä–æ–≥—Ä–µ—Å—Å–∞</h2>
        <button class="button reset-btn" onclick="resetProgress()">
            ‚ö†Ô∏è –°–±—Ä–æ—Å–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ
        </button>
    </div>
    
    <!-- –ö–Ω–æ–ø–∫–∞ –∑–∞–∫—Ä—ã—Ç–∏—è -->
    <div class="card">
        <div class="button-group">
            <button class="button close-btn" onclick="window.Telegram.WebApp.close()">–ó–∞–∫—Ä—ã—Ç—å</button>
        </div>
    </div>

    <script>
        // –ó–∞–≥—Ä—É–∑–∫–∞ –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö
        let coins = localStorage.getItem('finlevel_coins');
        let pillow = localStorage.getItem('finlevel_pillow');
        let needs = localStorage.getItem('finlevel_needs');
        let wants = localStorage.getItem('finlevel_wants');
        let budgetSavings = localStorage.getItem('finlevel_budgetSavings');
        let stocks = localStorage.getItem('finlevel_stocks');
        let realty = localStorage.getItem('finlevel_realty');
        let crypto = localStorage.getItem('finlevel_crypto');
        let goal = localStorage.getItem('finlevel_goal');
        let totalDividends = localStorage.getItem('finlevel_totalDividends');
        
        // –ù–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –º–∞–≥–∞–∑–∏–Ω–∞ –∏ —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤
        let multiplier = localStorage.getItem('finlevel_multiplier');
        let autoclicker = localStorage.getItem('finlevel_autoclicker');
        let referralCount = localStorage.getItem('finlevel_referralCount');
        let referralBonus = localStorage.getItem('finlevel_referralBonus');
        let capitalHistory = localStorage.getItem('finlevel_capitalHistory');
        
        coins = coins ? parseInt(coins) : 0;
        pillow = pillow ? parseInt(pillow) : 0;
        needs = needs ? parseInt(needs) : 0;
        wants = wants ? parseInt(wants) : 0;
        budgetSavings = budgetSavings ? parseInt(budgetSavings) : 0;
        stocks = stocks ? parseInt(stocks) : 0;
        realty = realty ? parseInt(realty) : 0;
        crypto = crypto ? parseInt(crypto) : 0;
        goal = goal ? parseInt(goal) : 10000;
        totalDividends = totalDividends ? parseInt(totalDividends) : 0;
        
        // –ú–∞–≥–∞–∑–∏–Ω
        multiplier = multiplier ? parseInt(multiplier) : 1;
        autoclicker = autoclicker ? autoclicker === 'true' : false;
        
        // –†–µ—Ñ–µ—Ä–∞–ª—ã
        referralCount = referralCount ? parseInt(referralCount) : 0;
        referralBonus = referralBonus ? parseInt(referralBonus) : 0;
        
        // –ò—Å—Ç–æ—Ä–∏—è –∫–∞–ø–∏—Ç–∞–ª–∞ –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–∞
        capitalHistory = capitalHistory ? JSON.parse(capitalHistory) : [0, 0, 0, 0, 0, 0, 0];
        
        // –≠–ª–µ–º–µ–Ω—Ç—ã
        const balanceEl = document.getElementById('balance');
        const pillowEl = document.getElementById('pillow');
        const pillowProgress = document.getElementById('pillowProgress');
        const needsEl = document.getElementById('needs');
        const wantsEl = document.getElementById('wants');
        const budgetSavingsEl = document.getElementById('budgetSavings');
        const stocksEl = document.getElementById('stocks');
        const realtyEl = document.getElementById('realty');
        const cryptoEl = document.getElementById('crypto');
        const riskEl = document.getElementById('riskAnalysis');
        const goalDisplayEl = document.getElementById('goalDisplay');
        const goalProgressEl = document.getElementById('goalProgress');
        const goalProgressBar = document.getElementById('goalProgressBar');
        
        // –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è
        const ach1 = document.getElementById('ach1');
        const ach2 = document.getElementById('ach2');
        const ach3 = document.getElementById('ach3');
        const achDiv1 = document.getElementById('achievement1');
        const achDiv2 = document.getElementById('achievement2');
        const achDiv3 = document.getElementById('achievement3');
        
        // –ú–∞–≥–∞–∑–∏–Ω
        const multiplierBtn = document.getElementById('multiplerBtn');
        const autoclickerBtn = document.getElementById('autoclickerBtn');
        const multiplierStatus = document.getElementById('multiplierStatus');
        const autoclickerStatus = document.getElementById('autoclickerStatus');
        
        // –†–µ—Ñ–µ—Ä–∞–ª—ã
        const referralCountEl = document.getElementById('referralCount');
        const referralBonusEl = document.getElementById('referralBonus');
        const referralLinkDiv = document.getElementById('referralLink');
        
        // –ì—Ä–∞—Ñ–∏–∫
        const capitalChart = document.getElementById('capitalChart');
        
        function updateCapitalHistory() {
            // –î–æ–±–∞–≤–ª—è–µ–º —Ç–µ–∫—É—â–∏–π –∫–∞–ø–∏—Ç–∞–ª –≤ –∏—Å—Ç–æ—Ä–∏—é
            let totalCapital = coins + stocks + realty + crypto + pillow;
            capitalHistory.push(totalCapital);
            if (capitalHistory.length > 30) {
                capitalHistory = capitalHistory.slice(-30);
            }
            localStorage.setItem('finlevel_capitalHistory', JSON.stringify(capitalHistory));
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –≥—Ä–∞—Ñ–∏–∫
            let maxCapital = Math.max(...capitalHistory, 1);
            let bars = '';
            for (let i = 0; i < capitalHistory.length; i++) {
                let height = (capitalHistory[i] / maxCapital) * 100;
                bars += `<div class="chart-bar" style="height: ${height}px;"></div>`;
            }
            capitalChart.innerHTML = bars;
        }
        
        function updateAchievements() {
            // –î–æ—Å—Ç–∏–∂–µ–Ω–∏–µ 1: 100 –º–æ–Ω–µ—Ç
            if (coins >= 100) {
                ach1.textContent = '‚úÖ';
                achDiv1.classList.add('unlocked');
            } else {
                ach1.textContent = '‚ùå';
                achDiv1.classList.remove('unlocked');
            }
            
            // –î–æ—Å—Ç–∏–∂–µ–Ω–∏–µ 2: –¥–∏–≤–µ—Ä—Å–∏—Ñ–∏–∫–∞—Ü–∏—è (–≤—Å–µ –∞–∫—Ç–∏–≤—ã > 0)
            if (stocks > 0 && realty > 0 && crypto > 0) {
                ach2.textContent = '‚úÖ';
                achDiv2.classList.add('unlocked');
            } else {
                ach2.textContent = '‚ùå';
                achDiv2.classList.remove('unlocked');
            }
            
            // –î–æ—Å—Ç–∏–∂–µ–Ω–∏–µ 3: 100+ –¥–∏–≤–∏–¥–µ–Ω–¥–æ–≤ –≤—Å–µ–≥–æ
            if (totalDividends >= 100) {
                ach3.textContent = '‚úÖ';
                achDiv3.classList.add('unlocked');
            } else {
                ach3.textContent = '‚ùå';
                achDiv3.classList.remove('unlocked');
            }
        }
        
        function updateAll() {
            balanceEl.textContent = coins;
            pillowEl.textContent = pillow;
            needsEl.textContent = needs;
            wantsEl.textContent = wants;
            budgetSavingsEl.textContent = budgetSavings;
            stocksEl.textContent = stocks;
            realtyEl.textContent = realty;
            cryptoEl.textContent = crypto;
            
            // –ü—Ä–æ–≥—Ä–µ—Å—Å –ø–æ–¥—É—à–∫–∏
            let pillowPercent = (pillow / 1000) * 100;
            if (pillowPercent > 100) pillowPercent = 100;
            pillowProgress.style.width = pillowPercent + '%';
            
            // –ü—Ä–æ–≥—Ä–µ—Å—Å —Ü–µ–ª–∏
            let goalPercent = (coins / goal) * 100;
            if (goalPercent > 100) goalPercent = 100;
            goalProgressBar.style.width = goalPercent + '%';
            goalProgressEl.textContent = Math.round(goalPercent) + '%';
            goalDisplayEl.textContent = goal.toLocaleString();
            
            // –°—Ç–∞—Ç—É—Å –º–∞–≥–∞–∑–∏–Ω–∞
            multiplierBtn.textContent = multiplier === 1 ? 'üìà –ú–Ω–æ–∂–∏—Ç–µ–ª—å –¥–æ—Ö–æ–¥–∞ x2 (—Ü–µ–Ω–∞: 500)' : '‚úÖ –ú–Ω–æ–∂–∏—Ç–µ–ª—å x2 –∫—É–ø–ª–µ–Ω';
            multiplierBtn.disabled = multiplier > 1;
            multiplierStatus.textContent = `–ú–Ω–æ–∂–∏—Ç–µ–ª—å: x${multiplier}`;
            
            autoclickerBtn.textContent = autoclicker ? '‚úÖ –ê–≤—Ç–æ–∫–ª–∏–∫–µ—Ä –∫—É–ø–ª–µ–Ω' : '‚ö° –ê–≤—Ç–æ–∫–ª–∏–∫–µ—Ä (—Ü–µ–Ω–∞: 1000)';
            autoclickerBtn.disabled = autoclicker;
            autoclickerStatus.textContent = `–ê–≤—Ç–æ–∫–ª–∏–∫–µ—Ä: ${autoclicker ? '–≤–∫–ª' : '–≤—ã–∫–ª'}`;
            
            // –†–µ—Ñ–µ—Ä–∞–ª—ã
            referralCountEl.textContent = referralCount;
            referralBonusEl.textContent = referralBonus;
            
            updateAchievements();
            updateCapitalHistory();
        }
        updateAll();
        
        // –ê–≤—Ç–æ–∫–ª–∏–∫–µ—Ä
        if (autoclicker) {
            setInterval(() => {
                addCoin();
            }, 5000);
        }
        
        function saveAll() {
            localStorage.setItem('finlevel_coins', coins);
            localStorage.setItem('finlevel_pillow', pillow);
            localStorage.setItem('finlevel_needs', needs);
            localStorage.setItem('finlevel_wants', wants);
            localStorage.setItem('finlevel_budgetSavings', budgetSavings);
            localStorage.setItem('finlevel_stocks', stocks);
            localStorage.setItem('finlevel_realty', realty);
            localStorage.setItem('finlevel_crypto', crypto);
            localStorage.setItem('finlevel_goal', goal);
            localStorage.setItem('finlevel_totalDividends', totalDividends);
            localStorage.setItem('finlevel_multiplier', multiplier);
            localStorage.setItem('finlevel_autoclicker', autoclicker);
            localStorage.setItem('finlevel_referralCount', referralCount);
            localStorage.setItem('finlevel_referralBonus', referralBonus);
        }
        
        // –£—Ä–æ–≤–µ–Ω—å 1
        function addCoin() {
            coins += multiplier;
            saveAll();
            updateAll();
            if (window.Telegram.WebApp.HapticFeedback) {
                window.Telegram.WebApp.HapticFeedback.impactOccurred('light');
            }
        }
        
        // –£—Ä–æ–≤–µ–Ω—å 2
        function saveToPillow() {
            if (coins < 1) {
                alert('–ù–µ—Ç –º–æ–Ω–µ—Ç –¥–ª—è –æ—Ç–∫–ª–∞–¥—ã–≤–∞–Ω–∏—è');
                return;
            }
            let saveAmount = Math.floor(coins * 0.1);
            if (saveAmount < 1) saveAmount = 1;
            coins -= saveAmount;
            pillow += saveAmount;
            saveAll();
            updateAll();
        }
        
        // –£—Ä–æ–≤–µ–Ω—å 3
        function distributeIncome() {
            if (coins < 100) {
                alert('–ù—É–∂–Ω–æ –º–∏–Ω–∏–º—É–º 100 –º–æ–Ω–µ—Ç');
                return;
            }
            coins -= 100;
            needs += 50;
            wants += 30;
            budgetSavings += 20;
            saveAll();
            updateAll();
        }
        
        function spend(category, amount) {
            if (coins < amount) {
                alert('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç');
                return;
            }
            coins -= amount;
            if (category === 'needs') needs += amount;
            if (category === 'wants') wants += amount;
            if (category === 'budgetSavings') budgetSavings += amount;
            saveAll();
            updateAll();
        }
        
        // –£—Ä–æ–≤–µ–Ω—å 4
        function invest(asset, amount) {
            if (coins < amount) {
                alert('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç');
                return;
            }
            coins -= amount;
            if (asset === 'stocks') stocks += amount;
            if (asset === 'realty') realty += amount;
            if (asset === 'crypto') crypto += amount;
            saveAll();
            updateAll();
        }
        
        function updateMarket() {
            let stocksChange = Math.floor(Math.random() * 50) - 20;
            let realtyChange = Math.floor(Math.random() * 25) - 10;
            let cryptoChange = Math.floor(Math.random() * 120) - 40;
            
            stocks = Math.max(0, stocks + Math.floor(stocks * stocksChange / 100));
            realty = Math.max(0, realty + Math.floor(realty * realtyChange / 100));
            crypto = Math.max(0, crypto + Math.floor(crypto * cryptoChange / 100));
            
            saveAll();
            updateAll();
            alert(`üìä –ò–∑–º–µ–Ω–µ–Ω–∏—è —Ä—ã–Ω–∫–∞:\n–ê–∫—Ü–∏–∏: ${stocksChange}%\n–ù–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å: ${realtyChange}%\n–ö—Ä–∏–ø—Ç–∞: ${cryptoChange}%`);
        }
        
        // –£—Ä–æ–≤–µ–Ω—å 5
        function analyzeRisk() {
            let total = stocks + realty + crypto;
            if (total === 0) {
                riskEl.innerHTML = 'üìâ –ù–µ—Ç –∞–∫—Ç–∏–≤–æ–≤ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞';
                return;
            }
            let stocksPct = (stocks / total * 100).toFixed(1);
            let realtyPct = (realty / total * 100).toFixed(1);
            let cryptoPct = (crypto / total * 100).toFixed(1);
            
            let risk = 'üü¢ –ù–∏–∑–∫–∏–π';
            let advice = '–•–æ—Ä–æ—à–æ —Å–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–æ';
            
            if (crypto > total * 0.3) {
                risk = 'üî¥ –í—ã—Å–æ–∫–∏–π';
                advice = '–°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –∫—Ä–∏–ø—Ç—ã, —Ä–∞—Å—Å–º–æ—Ç—Ä–∏—Ç–µ —Å–Ω–∏–∂–µ–Ω–∏–µ –¥–æ–ª–∏';
            } else if (stocks > total * 0.6) {
                risk = 'üü° –°—Ä–µ–¥–Ω–∏–π';
                advice = '–•–æ—Ä–æ—à–∏–π —Ä–æ—Å—Ç, –Ω–æ –¥–æ–±–∞–≤—å—Ç–µ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏';
            } else if (realty > total * 0.5) {
                risk = 'üü¢ –ù–∏–∑–∫–∏–π';
                advice = '–ö–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω—ã–π –ø–æ—Ä—Ç—Ñ–µ–ª—å, –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –∞–∫—Ü–∏–∏ –¥–ª—è —Ä–æ—Å—Ç–∞';
            }
            
            riskEl.innerHTML = `
                üìä –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ:<br>
                üìà –ê–∫—Ü–∏–∏: ${stocksPct}%<br>
                üè† –ù–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å: ${realtyPct}%<br>
                ‚Çø –ö—Ä–∏–ø—Ç–∞: ${cryptoPct}%<br>
                ‚ö†Ô∏è –†–∏—Å–∫: ${risk}<br>
                üí° –°–æ–≤–µ—Ç: ${advice}
            `;
        }
        
        // –£—Ä–æ–≤–µ–Ω—å 6
        function collectDividends() {
            let totalPortfolio = stocks + realty + crypto;
            if (totalPortfolio === 0) {
                alert('–ù–µ—Ç –∞–∫—Ç–∏–≤–æ–≤ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∏–≤–∏–¥–µ–Ω–¥–æ–≤');
                return;
            }
            let dividend = Math.floor(totalPortfolio * 0.01);
            if (dividend < 1) dividend = 1;
            coins += dividend;
            totalDividends += dividend;
            saveAll();
            updateAll();
            alert(`üíµ –ü–æ–ª—É—á–µ–Ω–æ ${dividend} –º–æ–Ω–µ—Ç –¥–∏–≤–∏–¥–µ–Ω–¥–æ–≤`);
        }
        
        // –£—Ä–æ–≤–µ–Ω—å 7
        function setGoal() {
            let newGoal = prompt('–í–≤–µ–¥–∏—Ç–µ –≤–∞—à—É —Ñ–∏–Ω–∞–Ω—Å–æ–≤—É—é —Ü–µ–ª—å (–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–æ–Ω–µ—Ç):', goal);
            if (newGoal && !isNaN(newGoal) && parseInt(newGoal) > 0) {
                goal = parseInt(newGoal);
                saveAll();
                updateAll();
                alert(`‚úÖ –ù–æ–≤–∞—è —Ü–µ–ª—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞: ${goal} –º–æ–Ω–µ—Ç`);
            }
        }
        
        // –ú–∞–≥–∞–∑–∏–Ω
        function buyMultiplier() {
            if (coins < 500) {
                alert('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç');
                return;
            }
            coins -= 500;
            multiplier = 2;
            saveAll();
            updateAll();
            alert('‚úÖ –ú–Ω–æ–∂–∏—Ç–µ–ª—å –¥–æ—Ö–æ–¥–∞ x2 –∫—É–ø–ª–µ–Ω! –¢–µ–ø–µ—Ä—å –∑–∞ –∫–∞–∂–¥—ã–π –∫–ª–∏–∫ +2 –º–æ–Ω–µ—Ç—ã.');
        }
        
        function buyAutoClicker() {
            if (coins < 1000) {
                alert('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç');
                return;
            }
            coins -= 1000;
            autoclicker = true;
            saveAll();
            updateAll();
            alert('‚úÖ –ê–≤—Ç–æ–∫–ª–∏–∫–µ—Ä –∫—É–ø–ª–µ–Ω! –û–Ω –±—É–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è—Ç—å –º–æ–Ω–µ—Ç—ã –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥.');
        }
        
        // –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞
        function generateReferralLink() {
            let referralCode = Math.random().toString(36).substring(2, 10);
            let link = `https://t.me/FinLevelGameBot?start=ref_${referralCode}`;
            referralLinkDiv.innerHTML = `üîó –¢–≤–æ—è —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞:<br><code>${link}</code>`;
            referralLinkDiv.style.display = 'block';
            
            // –î–ª—è –¥–µ–º–æ –¥–æ–±–∞–≤–ª—è–µ–º –±–æ–Ω—É—Å
            referralCount++;
            referralBonus += 50;
            coins += 50;
            saveAll();
            updateAll();
            alert('üéÅ –ó–∞ —Å–æ–∑–¥–∞–Ω–∏–µ —Å—Å—ã–ª–∫–∏ —Ç—ã –ø–æ–ª—É—á–∏–ª 50 –º–æ–Ω–µ—Ç! –û—Ç–ø—Ä–∞–≤—å –µ—ë –¥—Ä—É–∑—å—è–º.');
        }
        
        // –°–±—Ä–æ—Å –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
        function resetProgress() {
            if (confirm('–¢–æ—á–Ω–æ —Å–±—Ä–æ—Å–∏—Ç—å –≤–µ—Å—å –ø—Ä–æ–≥—Ä–µ—Å—Å? –í—Å–µ –º–æ–Ω–µ—Ç—ã, –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏ –∏ —Ü–µ–ª–∏ –±—É–¥—É—Ç –ø–æ—Ç–µ—Ä—è–Ω—ã.')) {
                coins = 0;
                pillow = 0;
                needs = 0;
                wants = 0;
                budgetSavings = 0;
                stocks = 0;
                realty = 0;
                crypto = 0;
                goal = 10000;
                totalDividends = 0;
                multiplier = 1;
                autoclicker = false;
                referralCount = 0;
                referralBonus = 0;
                capitalHistory = [0, 0, 0, 0, 0, 0, 0];
                saveAll();
                updateAll();
                alert('‚úÖ –ü—Ä–æ–≥—Ä–µ—Å—Å —Å–±—Ä–æ—à–µ–Ω');
            }
        }
        
        const tg = window.Telegram.WebApp;
        tg.ready();
        tg.expand();
    </script>
</body>
</html>
